class EnhancedReportGenerator{constructor(config={}){this.config={fileName:"Portnox_TCO_Analysis_Report.pdf",pageSize:"a4",pageOrientation:"portrait",pageMargins:[40,60,40,60],enableCharts:true,addWatermark:false,companyLogo:null,...config};this.setupChartCapturing()}setupChartCapturing(){this.canCaptureCharts=typeof html2canvas!=="undefined";if(!this.canCaptureCharts){console.warn("html2canvas not available, charts will not be included in PDF report")}}generateReport(resultsData,userConfig,selectedVendors){console.log("Generating enhanced PDF report...");if(this.config.enableCharts&&this.canCaptureCharts){return this.captureCharts().then(chartImages=>{const docDefinition=this.createDocDefinition(resultsData,userConfig,selectedVendors,chartImages);return this.generatePDF(docDefinition)})}else{const docDefinition=this.createDocDefinition(resultsData,userConfig,selectedVendors);return this.generatePDF(docDefinition)}}captureCharts(){const chartContainers=document.querySelectorAll(".chart-wrapper");const chartPromises=[];chartContainers.forEach(container=>{if(container.id){const chartPromise=html2canvas(container,{scale:2,backgroundColor:null,logging:false,useCORS:true}).then(canvas=>{return{id:container.id,data:canvas.toDataURL("image/png")}}).catch(error=>{console.error(`Error capturing chart ${container.id}:`,error);return null});chartPromises.push(chartPromise)}});return Promise.all(chartPromises).then(results=>{return results.filter(result=>result!==null)})}createDocDefinition(resultsData,userConfig,selectedVendors,chartImages=[]){const vendors=selectedVendors.map(id=>VENDORS[id]);const currentDate=(new Date).toLocaleDateString();const content=[this.createCoverPage(resultsData,currentDate),this.createTableOfContents(),this.createExecutiveSummary(resultsData,userConfig,vendors,chartImages),this.createFinancialAnalysis(resultsData,userConfig,vendors,chartImages),this.createSecurityAnalysis(resultsData,userConfig,vendors,chartImages),this.createTechnicalAnalysis(resultsData,userConfig,vendors,chartImages),this.createConfigurationDetails(userConfig)];return{info:{title:"Portnox TCO Analysis Report",author:"Portnox",subject:"Network Access Control Total Cost of Ownership Analysis",keywords:"NAC, TCO, ROI, Portnox, Zero Trust"},pageSize:this.config.pageSize,pageOrientation:this.config.pageOrientation,pageMargins:this.config.pageMargins,footer:function(currentPage,pageCount){return{text:`Page ${currentPage} of ${pageCount}`,alignment:"center",margin:[0,10,0,0],fontSize:9,color:"#666666"}},header:function(currentPage){if(currentPage===1)return null;return{columns:[{image:"data:image/png;base64,...",width:100,margin:[40,20,0,0]},{text:"Total Cost Analyzer Report",alignment:"right",margin:[0,20,40,0],fontSize:9,color:"#666666"}]}},content:content,styles:this.getDocumentStyles(),defaultStyle:{fontSize:10,color:"#333333"}}}generatePDF(docDefinition){return new Promise((resolve,reject)=>{try{pdfMake.createPdf(docDefinition).download(this.config.fileName);resolve(true)}catch(error){console.error("Error generating PDF report:",error);reject(error)}})}createCoverPage(resultsData,currentDate){return{stack:[{text:"Zero Trust Total Cost Analyzer",style:"title",margin:[0,100,0,20]},{text:"Multi-Vendor NAC Solution Comparison Report",style:"subtitle",margin:[0,0,0,40]},{image:"data:image/png;base64,...",width:200,alignment:"center",margin:[0,0,0,40]},{text:`Generated on: ${currentDate}`,alignment:"center",margin:[0,60,0,0]}],pageBreak:"after"}}createTableOfContents(){return{toc:{title:{text:"Table of Contents",style:"header1"}},pageBreak:"after"}}createExecutiveSummary(resultsData,userConfig,vendors,chartImages){return{stack:[{text:"Executive Summary",style:"header1",tocItem:true}],pageBreak:"after"}}createFinancialAnalysis(resultsData,userConfig,vendors,chartImages){return{stack:[{text:"Financial Analysis",style:"header1",tocItem:true}],pageBreak:"after"}}createSecurityAnalysis(resultsData,userConfig,vendors,chartImages){return{stack:[{text:"Security & Compliance Analysis",style:"header1",tocItem:true}],pageBreak:"after"}}createTechnicalAnalysis(resultsData,userConfig,vendors,chartImages){return{stack:[{text:"Technical Comparison",style:"header1",tocItem:true}],pageBreak:"after"}}createConfigurationDetails(userConfig){return{stack:[{text:"Appendix: Configuration Details",style:"header1",tocItem:true}]}}getDocumentStyles(){return{title:{fontSize:28,bold:true,color:"#1a5a96",alignment:"center"},subtitle:{fontSize:16,color:"#666666",alignment:"center"},header1:{fontSize:18,bold:true,color:"#1a5a96",margin:[0,20,0,10]},header2:{fontSize:14,bold:true,color:"#333333",margin:[0,15,0,5]},header3:{fontSize:12,bold:true,color:"#333333",margin:[0,10,0,5]},tableHeader:{bold:true,fontSize:12,color:"#ffffff",fillColor:"#1a5a96",alignment:"center"},default:{fontSize:10,color:"#333333"},tableCell:{fontSize:10},highlightCell:{fontSize:10,color:"#1a5a96",bold:true}}}}if(typeof module!=="undefined"&&module.exports){module.exports={EnhancedReportGenerator:EnhancedReportGenerator}}else{window.EnhancedReportGenerator=EnhancedReportGenerator}