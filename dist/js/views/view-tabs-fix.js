document.addEventListener("DOMContentLoaded",function(){console.log("Applying improved view tabs fix...");setTimeout(fixViewTabs,500)});function fixViewTabs(){const mainTabsContainers=document.querySelectorAll(".main-tabs");if(mainTabsContainers.length===0){console.warn("No main tabs found, will try again in 500ms");setTimeout(fixViewTabs,500);return}if(mainTabsContainers.length>1){console.log(`Found ${mainTabsContainers.length} main-tabs containers, removing duplicates`);for(let i=1;i<mainTabsContainers.length;i++){mainTabsContainers[i].remove()}}const mainTabsContainer=document.querySelector(".main-tabs");if(mainTabsContainer){const requiredViews=["executive","financial","security","technical"];const existingTabs={};const tabs=Array.from(mainTabsContainer.querySelectorAll(".main-tab"));tabs.forEach(tab=>{const viewId=tab.getAttribute("data-view");if(viewId&&requiredViews.includes(viewId)){if(!existingTabs[viewId]){existingTabs[viewId]=tab}else{tab.remove()}}else if(!viewId){tab.remove()}});requiredViews.forEach(viewId=>{if(!existingTabs[viewId]){const newTab=document.createElement("button");newTab.className="main-tab";newTab.setAttribute("data-view",viewId);let icon="fa-chart-line";let text="Executive";switch(viewId){case"financial":icon="fa-dollar-sign";text="Financial";break;case"security":icon="fa-shield-alt";text="Security";break;case"technical":icon="fa-cogs";text="Technical";break}newTab.innerHTML=`<i class="fas ${icon}"></i> ${text}`;mainTabsContainer.appendChild(newTab);console.log(`Added missing tab for ${viewId} view`)}});const updatedTabs=mainTabsContainer.querySelectorAll(".main-tab");updatedTabs.forEach(tab=>{const viewId=tab.getAttribute("data-view");const newTab=tab.cloneNode(true);tab.parentNode.replaceChild(newTab,tab);newTab.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();console.log(`Switching to view: ${viewId}`);updatedTabs.forEach(t=>t.classList.remove("active"));newTab.classList.add("active");const viewPanels=document.querySelectorAll(".view-panel");viewPanels.forEach(panel=>panel.classList.remove("active"));const targetPanel=document.querySelector(`.view-panel[data-view="${viewId}"]`);if(targetPanel){targetPanel.classList.add("active");if(window.refreshChartsInView&&typeof window.refreshChartsInView==="function"){window.refreshChartsInView(viewId)}else{window.refreshChartsInView=function(viewId){console.log(`Refreshing charts in view: ${viewId}`);const viewPanel=document.querySelector(`.view-panel[data-view="${viewId}"]`);if(!viewPanel)return;const activeResultsPanel=viewPanel.querySelector(".results-panel.active");if(!activeResultsPanel)return;const panelId=activeResultsPanel.id;const chartContainers=activeResultsPanel.querySelectorAll(".chart-wrapper");chartContainers.forEach(container=>{if(window.apexChartManager&&typeof window.apexChartManager.refreshChart==="function"){window.apexChartManager.refreshChart(container.id)}else if(window.d3Manager&&typeof window.d3Manager.refreshChart==="function"){window.d3Manager.refreshChart(container.id)}else if(window.chartManager&&typeof window.chartManager.refreshChart==="function"){window.chartManager.refreshChart(container.id)}})}}}else{console.warn(`View panel not found for ${viewId}`)}})});let activeViewPanel=document.querySelector(".view-panel.active");if(activeViewPanel){const activeViewId=activeViewPanel.getAttribute("data-view");if(activeViewId){const activeTab=mainTabsContainer.querySelector(`.main-tab[data-view="${activeViewId}"]`);if(activeTab){updatedTabs.forEach(t=>t.classList.remove("active"));activeTab.classList.add("active")}}}else{const executiveTab=mainTabsContainer.querySelector('.main-tab[data-view="executive"]');if(executiveTab){updatedTabs.forEach(t=>t.classList.remove("active"));executiveTab.classList.add("active");const executivePanel=document.querySelector('.view-panel[data-view="executive"]');if(executivePanel){document.querySelectorAll(".view-panel").forEach(p=>p.classList.remove("active"));executivePanel.classList.add("active")}}}console.log("Main tabs fixed successfully")}}